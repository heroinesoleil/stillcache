<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>stillcache</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- PNG favicon for modern browsers -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <!-- Apple Touch Icon (iOS home screen) -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <header>
        <h1>stillcache</h1>
        <!-- Light/Dark Mode Toggle -->
        <div class="toggle-container">
            <input type="checkbox" id="mode-toggle" class="mode-toggle" />
            <label for="mode-toggle" class="toggle-label"></label>
        </div>  
    </header>
    
            <div class="location-container">
        	<div class="location-text">
        		<span id="day-greeting"></span>
        		<div class="bottom-line">
    			<span id="clock"></span>
    			<span id="weather">
       			<span id="weather-text"></span>
        		<span id="weather-icon"></span>
    			</span>
				</div>
        	</div>
        </div>

    <section class="film-info">
        <div class="film-text">
            <h2>Kiki's Delivery Service (1989)</h2>
            <p class="directed">Directed by Hayao Miyazaki</p>
            <p class="details">U ‧ 1989 ‧ Family/Fantasy ‧ 1h 42m</p>
        </div>

        <div class="film-images">
            <img src="images/kiki-title-card.png" alt="Kiki's Delivery Service Title Card'">
            <img src="images/kiki-001.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-002.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-003.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-004.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-005.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-006.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-007.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-008.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-009.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-010.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-011.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-012.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-013.png" alt="Kiki's Delivery Service">
            <img src="images/kiki-014.png" alt="Kiki's Delivery Service">
        </div>
    </section>

    <section class="film-info">
        <div class="film-text">
            <h2>House (1977)</h2>
            <p class="directed">Directed by Nobuhiko Obayashi</p>
            <p class="details">15 ‧ 1977 ‧ Horror/Fantasy ‧ 1h 28m</p>
        </div>

        <div class="film-images">
            <img src="images/house-title-card.png" alt="House (1977) Title Card">
            <img src="images/house-001.png" alt="House (1977)">
            <img src="images/house-002.png" alt="House (1977)">
            <img src="images/house-003.png" alt="House (1977)">
            <img src="images/house-004.png" alt="House (1977)">
            <img src="images/house-005.png" alt="House (1977)">
            <img src="images/house-006.png" alt="House (1977)">
            <img src="images/house-007.png" alt="House (1977)">
            <img src="images/house-008.png" alt="House (1977)">
            <img src="images/house-009.png" alt="House (1977)">
            <img src="images/house-010.png" alt="House (1977)">
            <img src="images/house-011.png" alt="House (1977)">
            <img src="images/house-012.png" alt="House (1977)">
        </div>
    </section>

    <footer>
        <p>©2025 Stillcache</p>
    </footer>

    <script>
        const toggle = document.getElementById("mode-toggle");

        // Check for stored theme preference
        if (localStorage.getItem("theme") === "dark") {
            document.body.classList.add("dark-mode");
            toggle.checked = true;
        }

        // Toggle dark/light mode
        toggle.addEventListener("change", () => {
            if (toggle.checked) {
                document.body.classList.add("dark-mode");
                localStorage.setItem("theme", "dark");
            } else {
                document.body.classList.remove("dark-mode");
                localStorage.setItem("theme", "light");
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
    const clockElement = document.getElementById('clock');
    const dayGreetingElement = document.getElementById('day-greeting');
    let timeZone = null;

    function updateClock() {
        const now = timeZone ? new Date(new Date().toLocaleString('en-US', { timeZone })) : new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        clockElement.textContent = `${hours}:${minutes}:${seconds}`;
    }

    function updateDayGreeting() {
    const now = timeZone ? new Date(new Date().toLocaleString('en-US', { timeZone })) : new Date();
    const options = { 
        weekday: 'long', 
        day: 'numeric', 
        month: 'long',
        year: 'numeric',
        formatMatcher: 'basic'
    };
    
    const formatter = new Intl.DateTimeFormat('en-US', options);
    const parts = formatter.formatToParts(now);
    
    const formattedDate = `${parts.find(part => part.type === 'weekday').value} ${parts.find(part => part.type === 'day').value} ${parts.find(part => part.type === 'month').value}`;

    const hour = now.getHours();
    let greeting;
    if (hour < 12) {
        greeting = "Good Morning";
    } else if (hour < 18) {
        greeting = "Good Afternoon";
    } else {
        greeting = "Good Evening";
    }

    dayGreetingElement.textContent = `${formattedDate}, ${greeting}`;
	
	}	

    function getWeatherIcon(weatherCode) {
        const detailedIconMap = {
            '1000': '☀️', // Clear, Sunny
            '1100': '⛅', // Mostly Clear
            '1101': '🌤️', // Partly Cloudy
            '1102': '☁️', // Mostly Cloudy
            '1001': '☁️', // Cloudy
            '2000': '🌫️', // Fog
            '4000': '🌧️', // Drizzle
            '4001': '🌧️', // Rain
            '4200': '🌧️', // Light Rain
            '4201': '🌧️', // Heavy Rain
            '5000': '🌨️', // Snow
            '5001': '🌨️', // Flurries
            '5100': '🌨️', // Light Snow
            '5101': '🌨️', // Heavy Snow
            '6000': '🌧️', // Freezing Drizzle
            '6001': '🌧️', // Freezing Rain
            '6200': '🌧️', // Light Freezing Rain
            '6201': '🌧️', // Heavy Freezing Rain
            '7000': '🌨️', // Ice Pellets
            '7101': '🌨️', // Heavy Ice Pellets
            '7102': '🌨️', // Light Ice Pellets
            '8000': '⛈️', // Thunderstorm
        };

        const categoryMap = {
            '0': '🌡️', // Unknown
            '1': '☀️', // Clear or cloudy
            '2': '🌫️', // Fog, mist
            '3': '💨', // Wind
            '4': '🌧️', // Rain, drizzle
            '5': '🌨️', // Snow, ice
            '6': '🌧️', // Freezing rain or drizzle
            '7': '🌨️', // Ice pellets, hail
            '8': '⛈️', // Thunderstorm
        };

        if (detailedIconMap.hasOwnProperty(weatherCode)) {
            return detailedIconMap[weatherCode];
        }

        const category = weatherCode.toString()[0];
        return categoryMap[category] || '🌡️'; // Default to thermometer if no match found
    }

    function getWeather() {
        const apiKey = 'Zg1S3Z7rj790j4KKG7M7bfZAQxfjsU1v';
        let cityName = "Unknown Location";

        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(locationData => {
                console.log('Location data:', locationData);
                const lat = locationData.latitude;
                const lon = locationData.longitude;
                cityName = locationData.city || "Unknown Location"; // Store the city name from ipapi.co
                timeZone = locationData.timezone; // Store the timezone
                updateDayGreeting(); // Update the day and greeting immediately after fetching the timezone
                const url = `https://api.tomorrow.io/v4/weather/forecast?location=${lat},${lon}&apikey=${apiKey}`;

                console.log('Weather API URL:', url);
                return fetch(url, { method: 'GET', headers: { accept: 'application/json' } });
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Full Weather API response:', data);

                if (data.timelines && data.timelines.minutely && data.timelines.minutely[0]) {
                    const currentWeather = data.timelines.minutely[0].values;
                    const temp = Math.round(currentWeather.temperature);
                    const weatherCode = currentWeather.weatherCode.toString();
                    const icon = getWeatherIcon(weatherCode);

                    if (!cityName && data.location) {
                        cityName = data.location.name || data.location.city || data.location.address || cityName;
                    }

                    console.log('Location being used:', cityName);

                    document.getElementById('weather-icon').textContent = icon;
                    document.getElementById('weather-text').textContent = `${cityName} ${temp}°C`;
                } else {
                    throw new Error('Unexpected API response structure');
                }
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                document.getElementById('weather-text').textContent = `Weather data unavailable: ${error.message}`;
            });
    }

    if (document.getElementById('day-greeting') && document.getElementById('weather')) {
        getWeather();
        updateDayGreeting(); // Initial update of day and greeting
        setInterval(updateDayGreeting, 60000); // Update the day and greeting every minute
        setInterval(getWeather, 600000);
    }

    setInterval(updateClock, 1000);
    updateClock();
});
        
        
        
        
        
        
    </script>

</body>

</html>
